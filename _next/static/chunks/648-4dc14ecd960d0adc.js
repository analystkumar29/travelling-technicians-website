(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[648],{8964:function(e,t,n){"use strict";n.d(t,{Z:function(){return AddressAutocomplete}});var o=n(5893),a=n(7294),s=n(5154),i=n(3597);function AddressAutocomplete(e){let{onAddressSelect:t,placeholder:n="Enter your address",className:c=""}=e,[u,f]=(0,a.useState)(""),[p,g]=(0,a.useState)([]),[h,y]=(0,a.useState)(!1),[v,b]=(0,a.useState)(!1),[w,E]=(0,a.useState)(!1),[S,C]=(0,a.useState)(""),P=(0,a.useRef)(null),j=(0,a.useRef)(null),N=(0,a.useRef)(null),A=(0,a.useRef)("jsonp_callback_".concat(Date.now(),"_").concat(Math.round(1e5*Math.random()))),[I,D]=(0,a.useState)(""),[O,T]=(0,a.useState)("");(0,a.useEffect)(()=>{let e=setTimeout(()=>{if(u.length>3){T(u),fetchSuggestions();let e=u.match(/[A-Za-z]\d[A-Za-z]\s?\d[A-Za-z]\d/i);if(e){let t=e[0].toUpperCase().replace(/\s/g,""),n="".concat(t.slice(0,3)," ").concat(t.slice(3));D(n)}}else g([])},500);return()=>clearTimeout(e)},[u]),(0,a.useEffect)(()=>(window[A.current]=e=>{console.log("JSONP Suggestions received:",e),g(e||[]),E(e&&e.length>0),y(!1),N.current&&N.current.parentNode&&(N.current.parentNode.removeChild(N.current),N.current=null)},()=>{delete window[A.current]}),[]),(0,a.useEffect)(()=>{function handleClickOutside(e){P.current&&!P.current.contains(e.target)&&j.current&&!j.current.contains(e.target)&&E(!1)}return document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}},[]);let fetchSuggestions=()=>{if(!u.trim())return;y(!0),C(""),N.current&&N.current.parentNode&&N.current.parentNode.removeChild(N.current);let e=document.createElement("script");e.src="https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(u)," British Columbia, Canada&countrycodes=ca&limit=5&addressdetails=1&json_callback=").concat(A.current),document.body.appendChild(e),N.current=e,setTimeout(()=>{h&&(y(!1),C("Request timed out. Please try again."),N.current&&N.current.parentNode&&(N.current.parentNode.removeChild(N.current),N.current=null))},5e3)},handleSuggestionClick=e=>{try{var n,o,a,s,i,c;let u=O.match(/^\s*(\d+)\s+/),p=u?u[1]:"",g=(null===(n=e.address)||void 0===n?void 0:n.road)||(null===(o=e.address)||void 0===o?void 0:o.street)||"",h=(null===(a=e.address)||void 0===a?void 0:a.city)||(null===(s=e.address)||void 0===s?void 0:s.town)||(null===(i=e.address)||void 0===i?void 0:i.village)||"",y=(null===(c=e.address)||void 0===c?void 0:c.postcode)||"";y&&6===y.length&&!y.includes(" ")&&(y="".concat(y.slice(0,3)," ").concat(y.slice(3)));let v=null!==e.display_name.match(/^\s*\d+\s+/),b="";b=p&&!v&&g?"".concat(p," ").concat(g,", ").concat(h,", BC ").concat(y,", Canada"):e.display_name,f(b),E(!1),y?(D(y),console.log("Suggestion clicked with postal code, calling onAddressSelect:",y),t(b,y)):C("Selected address is missing a postal code. Please enter it manually.")}catch(e){console.error("Error processing address selection:",e),C("Error processing selected address. Please try another or enter manually.")}},fetchAddressFromCoordinates=(e,n)=>{try{let o="https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(e,"&lon=").concat(n,"&addressdetails=1&zoom=18");fetch(o,{headers:{Accept:"application/json","User-Agent":"TheTravellingTechnicians/1.0"}}).then(e=>{if(!e.ok)throw Error("Failed to get address from coordinates: ".concat(e.status));return e.json()}).then(e=>{if(console.log("Reverse geocoding response:",e),e&&e.display_name){f(e.display_name);let n="";e.address&&e.address.postcode?(n=e.address.postcode.trim(),6!==n.length||n.includes(" ")||(n="".concat(n.slice(0,3)," ").concat(n.slice(3))),D(n),n?(console.log("Got location with postal code, calling onAddressSelect:",n),t(e.display_name,n),C("")):C("Could not determine postal code from your location. Please enter it manually.")):C("Your location was found, but no postal code was detected. Please add it manually.")}else throw f(""),Error("No address found for this location")}).catch(e=>{console.error("Error fetching address:",e),f(""),C("Failed to get your location. Please enter your address manually.")}).finally(()=>{b(!1)})}catch(e){console.error("Error in fetchAddressFromCoordinates:",e),b(!1),f(""),C("Error processing your location. Please enter your address manually.")}},validateManualInput=()=>{if(!u)return;if(I){validateAndSelectAddress(u,I);return}let e=u.match(/[A-Za-z]\d[A-Za-z]\s?\d[A-Za-z]\d/i);if(e){let t=e[0].toUpperCase().replace(/\s/g,""),n="".concat(t.slice(0,3)," ").concat(t.slice(3));validateAndSelectAddress(u,n)}else C("Please enter a valid Canadian postal code in your address (e.g., V6B 1A1)")},validateAndSelectAddress=(e,n)=>{let o=(0,i.mP)(n);console.log("Checking postal code:",n,"Result:",o),t(e,n),o&&o.serviceable?C(""):C("We don't currently service the area with postal code ".concat(n))};return(0,o.jsxs)("form",{className:"relative w-full",onSubmit:e=>{e.preventDefault(),validateManualInput()},children:[(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("input",{ref:j,type:"text",value:u,onChange:e=>f(e.target.value),onFocus:()=>{p.length>0&&E(!0)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),validateManualInput())},onBlur:()=>{setTimeout(()=>{let e=u.match(/[A-Za-z]\d[A-Za-z]\s?\d[A-Za-z]\d/i);if(e){let t=e[0].toUpperCase().replace(/\s/g,""),n="".concat(t.slice(0,3)," ").concat(t.slice(3));D(n)}},200)},placeholder:n,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500 pl-10 text-gray-800 placeholder-gray-400 ".concat(c),disabled:v}),(0,o.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:h||v?(0,o.jsx)(s.fCD,{className:"h-5 w-5 text-gray-400 animate-spin"}):(0,o.jsx)(s.Nh4,{className:"h-5 w-5 text-gray-400"})})]}),(0,o.jsx)("button",{type:"button",onClick:()=>{if(!navigator.geolocation){C("Geolocation is not supported by your browser");return}b(!0),C(""),f("Detecting your location..."),navigator.geolocation.getCurrentPosition(e=>{let{latitude:t,longitude:n}=e.coords;console.log("Got coordinates:",t,n),fetchAddressFromCoordinates(t,n)},e=>{b(!1),f(""),console.error("Geolocation error:",e);let t="Failed to get your location. Please enter your address manually.";1===e.code?t="Location access denied. Please grant permission or enter your address manually.":2===e.code?t="Location unavailable. Please enter your address manually.":3===e.code&&(t="Location request timed out. Please enter your address manually."),C(t)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})},disabled:v,className:"mt-2 w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:v?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.fCD,{className:"animate-spin h-5 w-5 mr-2"}),"Detecting your location..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.Nh4,{className:"h-5 w-5 mr-2 text-gray-500"}),"Use My Current Location"]})}),S&&(0,o.jsx)("p",{className:"mt-2 text-sm text-red-600",children:S}),w&&p.length>0&&(0,o.jsx)("div",{ref:P,className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md border border-gray-300 max-h-60 overflow-auto",children:p.map((e,t)=>(0,o.jsx)("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm",onClick:()=>handleSuggestionClick(e),children:e.display_name},"".concat(e.place_id||e.osm_id,"-").concat(t)))}),(0,o.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"Enter your street number first, then select a suggestion to combine them automatically."})]})}},1163:function(e,t,n){e.exports=n(8355)},689:function(e,t,n){"use strict";n.d(t,{p:function(){return H}});var o,a,s,i,c,u,f,p,g=n(7294),h=n.t(g,2),y=Object.defineProperty,d=(e,t,n)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,r=(e,t,n)=>(d(e,"symbol"!=typeof t?t+"":t,n),n);let v=new class{constructor(){r(this,"current",this.detect()),r(this,"handoffState","pending"),r(this,"currentId",0)}set(e){this.current!==e&&(this.handoffState="pending",this.currentId=0,this.current=e)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return"server"===this.current}get isClient(){return"client"===this.current}detect(){return"undefined"==typeof window||"undefined"==typeof document?"server":"client"}handoff(){"pending"===this.handoffState&&(this.handoffState="complete")}get isHandoffComplete(){return"complete"===this.handoffState}},l=(e,t)=>{v.isServer?(0,g.useEffect)(e,t):(0,g.useLayoutEffect)(e,t)},use_event_o=function(e){let t;let n=(t=(0,g.useRef)(e),l(()=>{t.current=e},[e]),t);return g.useCallback((...e)=>n.current(...e),[n])},b=null!=(f=g.useId)?f:function(){let e=function(){let e;let t=(e="undefined"==typeof document,(0,h.useSyncExternalStore)(()=>()=>{},()=>!1,()=>!e)),[n,o]=g.useState(v.isHandoffComplete);return n&&!1===v.isHandoffComplete&&o(!1),g.useEffect(()=>{!0!==n&&o(!0)},[n]),g.useEffect(()=>v.handoff(),[]),!t&&n}(),[t,n]=g.useState(e?()=>v.nextId():null);return l(()=>{null===t&&n(v.nextId())},[t]),null!=t?""+t:void 0};function use_resolve_button_type_i(e){var t;if(e.type)return e.type;let n=null!=(t=e.as)?t:"button";if("string"==typeof n&&"button"===n.toLowerCase())return"button"}let w=Symbol();function use_sync_refs_y(...e){let t=(0,g.useRef)(e);(0,g.useEffect)(()=>{t.current=e},[e]);let n=use_event_o(e=>{for(let n of t.current)null!=n&&("function"==typeof n?n(e):n.current=e)});return e.every(e=>null==e||(null==e?void 0:e[w]))?void 0:n}let E=(0,g.createContext)(null);E.displayName="OpenClosedContext";var S=((o=S||{})[o.Open=1]="Open",o[o.Closed=2]="Closed",o[o.Closing=4]="Closing",o[o.Opening=8]="Opening",o);function open_closed_s({value:e,children:t}){return g.createElement(E.Provider,{value:e},t)}function match_u(e,t,...n){if(e in t){let o=t[e];return"function"==typeof o?o(...n):o}let o=Error(`Tried to handle "${e}" but there is no handler defined. Only defined handlers are: ${Object.keys(t).map(e=>`"${e}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,match_u),o}function class_names_t(...e){return Array.from(new Set(e.flatMap(e=>"string"==typeof e?e.split(" "):[]))).filter(Boolean).join(" ")}var C=((a=C||{})[a.None=0]="None",a[a.RenderStrategy=1]="RenderStrategy",a[a.Static=2]="Static",a),P=((s=P||{})[s.Unmount=0]="Unmount",s[s.Hidden=1]="Hidden",s);function render_C({ourProps:e,theirProps:t,slot:n,defaultTag:o,features:a,visible:s=!0,name:i,mergeRefs:c}){c=null!=c?c:k;let u=R(t,e);if(s)return m(u,n,o,i,c);let f=null!=a?a:0;if(2&f){let{static:e=!1,...t}=u;if(e)return m(t,n,o,i,c)}if(1&f){let{unmount:e=!0,...t}=u;return match_u(e?0:1,{0:()=>null,1:()=>m({...t,hidden:!0,style:{display:"none"}},n,o,i,c)})}return m(u,n,o,i,c)}function m(e,t={},n,o,a){let{as:s=n,children:i,refName:c="ref",...u}=F(e,["unmount","static"]),f=void 0!==e.ref?{[c]:e.ref}:{},p="function"==typeof i?i(t):i;"className"in u&&u.className&&"function"==typeof u.className&&(u.className=u.className(t));let h={};if(t){let e=!1,n=[];for(let[o,a]of Object.entries(t))"boolean"==typeof a&&(e=!0),!0===a&&n.push(o);e&&(h["data-headlessui-state"]=n.join(" "))}if(s===g.Fragment&&Object.keys(x(u)).length>0){if(!(0,g.isValidElement)(p)||Array.isArray(p)&&p.length>1)throw Error(['Passing props on "Fragment"!',"",`The current component <${o} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(u).map(e=>`  - ${e}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(e=>`  - ${e}`).join(`
`)].join(`
`));let e=p.props,t="function"==typeof(null==e?void 0:e.className)?(...t)=>class_names_t(null==e?void 0:e.className(...t),u.className):class_names_t(null==e?void 0:e.className,u.className),n=t?{className:t}:{};return(0,g.cloneElement)(p,Object.assign({},R(p.props,x(F(u,["ref"]))),h,f,{ref:a(p.ref,f.ref)},n))}return(0,g.createElement)(s,Object.assign({},F(u,["ref"]),s!==g.Fragment&&f,s!==g.Fragment&&h),p)}function render_I(){let e=(0,g.useRef)([]),t=(0,g.useCallback)(t=>{for(let n of e.current)null!=n&&("function"==typeof n?n(t):n.current=t)},[]);return(...n)=>{if(!n.every(e=>null==e))return e.current=n,t}}function k(...e){return e.every(e=>null==e)?void 0:t=>{for(let n of e)null!=n&&("function"==typeof n?n(t):n.current=t)}}function R(...e){if(0===e.length)return{};if(1===e.length)return e[0];let t={},n={};for(let o of e)for(let e in o)e.startsWith("on")&&"function"==typeof o[e]?(null!=n[e]||(n[e]=[]),n[e].push(o[e])):t[e]=o[e];if(t.disabled||t["aria-disabled"])return Object.assign(t,Object.fromEntries(Object.keys(n).map(e=>[e,void 0])));for(let e in n)Object.assign(t,{[e](t,...o){for(let a of n[e]){if((t instanceof Event||(null==t?void 0:t.nativeEvent)instanceof Event)&&t.defaultPrevented)return;a(t,...o)}}});return t}function U(e){var t;return Object.assign((0,g.forwardRef)(e),{displayName:null!=(t=e.displayName)?t:e.name})}function x(e){let t=Object.assign({},e);for(let e in t)void 0===t[e]&&delete t[e];return t}function F(e,t=[]){let n=Object.assign({},e);for(let e of t)e in n&&delete n[e];return n}let j=null!=(p=g.startTransition)?p:function(e){e()};var N=((i=N||{}).Space=" ",i.Enter="Enter",i.Escape="Escape",i.Backspace="Backspace",i.Delete="Delete",i.ArrowLeft="ArrowLeft",i.ArrowUp="ArrowUp",i.ArrowRight="ArrowRight",i.ArrowDown="ArrowDown",i.Home="Home",i.End="End",i.PageUp="PageUp",i.PageDown="PageDown",i.Tab="Tab",i),A=((c=A||{})[c.Open=0]="Open",c[c.Closed=1]="Closed",c),I=((u=I||{})[u.ToggleDisclosure=0]="ToggleDisclosure",u[u.CloseDisclosure=1]="CloseDisclosure",u[u.SetButtonId=2]="SetButtonId",u[u.SetPanelId=3]="SetPanelId",u[u.LinkPanel=4]="LinkPanel",u[u.UnlinkPanel=5]="UnlinkPanel",u);let D={0:e=>({...e,disclosureState:match_u(e.disclosureState,{0:1,1:0})}),1:e=>1===e.disclosureState?e:{...e,disclosureState:1},4:e=>!0===e.linkedPanel?e:{...e,linkedPanel:!0},5:e=>!1===e.linkedPanel?e:{...e,linkedPanel:!1},2:(e,t)=>e.buttonId===t.buttonId?e:{...e,buttonId:t.buttonId},3:(e,t)=>e.panelId===t.panelId?e:{...e,panelId:t.panelId}},O=(0,g.createContext)(null);function _(e){let t=(0,g.useContext)(O);if(null===t){let t=Error(`<${e} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,_),t}return t}O.displayName="DisclosureContext";let T=(0,g.createContext)(null);T.displayName="DisclosureAPIContext";let L=(0,g.createContext)(null);function ee(e,t){return match_u(t.type,D,e,t)}L.displayName="DisclosurePanelContext";let M=g.Fragment,B=C.RenderStrategy|C.Static,H=Object.assign(U(function(e,t){let{defaultOpen:n=!1,...o}=e,a=(0,g.useRef)(null),s=use_sync_refs_y(t,function(e,t=!0){return Object.assign(e,{[w]:t})}(e=>{a.current=e},void 0===e.as||e.as===g.Fragment)),i=(0,g.useRef)(null),c=(0,g.useRef)(null),u=(0,g.useReducer)(ee,{disclosureState:n?0:1,linkedPanel:!1,buttonRef:c,panelRef:i,buttonId:null,panelId:null}),[{disclosureState:f,buttonId:p},h]=u,y=use_event_o(e=>{h({type:1});let t=v.isServer?null:a instanceof Node?a.ownerDocument:null!=a&&a.hasOwnProperty("current")&&a.current instanceof Node?a.current.ownerDocument:document;if(!t||!p)return;let n=e?e instanceof HTMLElement?e:e.current instanceof HTMLElement?e.current:t.getElementById(p):t.getElementById(p);null==n||n.focus()}),b=(0,g.useMemo)(()=>({close:y}),[y]),E=(0,g.useMemo)(()=>({open:0===f,close:y}),[f,y]);return g.createElement(O.Provider,{value:u},g.createElement(T.Provider,{value:b},g.createElement(open_closed_s,{value:match_u(f,{0:S.Open,1:S.Closed})},render_C({ourProps:{ref:s},theirProps:o,slot:E,defaultTag:M,name:"Disclosure"}))))}),{Button:U(function(e,t){let n=b(),{id:o=`headlessui-disclosure-button-${n}`,...a}=e,[s,i]=_("Disclosure.Button"),c=(0,g.useContext)(L),u=null!==c&&c===s.panelId,f=(0,g.useRef)(null),p=use_sync_refs_y(f,t,u?null:s.buttonRef),h=render_I();(0,g.useEffect)(()=>{if(!u)return i({type:2,buttonId:o}),()=>{i({type:2,buttonId:null})}},[o,i,u]);let y=use_event_o(e=>{var t;if(u){if(1===s.disclosureState)return;switch(e.key){case N.Space:case N.Enter:e.preventDefault(),e.stopPropagation(),i({type:0}),null==(t=s.buttonRef.current)||t.focus()}}else switch(e.key){case N.Space:case N.Enter:e.preventDefault(),e.stopPropagation(),i({type:0})}}),v=use_event_o(e=>{e.key===N.Space&&e.preventDefault()}),w=use_event_o(t=>{var n;(function(e){let t=e.parentElement,n=null;for(;t&&!(t instanceof HTMLFieldSetElement);)t instanceof HTMLLegendElement&&(n=t),t=t.parentElement;let o=(null==t?void 0:t.getAttribute("disabled"))==="";return!(o&&function(e){if(!e)return!1;let t=e.previousElementSibling;for(;null!==t;){if(t instanceof HTMLLegendElement)return!1;t=t.previousElementSibling}return!0}(n))&&o})(t.currentTarget)||e.disabled||(u?(i({type:0}),null==(n=s.buttonRef.current)||n.focus()):i({type:0}))}),E=(0,g.useMemo)(()=>({open:0===s.disclosureState}),[s]),S=function(e,t){let[n,o]=(0,g.useState)(()=>use_resolve_button_type_i(e));return l(()=>{o(use_resolve_button_type_i(e))},[e.type,e.as]),l(()=>{n||t.current&&t.current instanceof HTMLButtonElement&&!t.current.hasAttribute("type")&&o("button")},[n,t]),n}(e,f);return render_C({mergeRefs:h,ourProps:u?{ref:p,type:S,onKeyDown:y,onClick:w}:{ref:p,id:o,type:S,"aria-expanded":0===s.disclosureState,"aria-controls":s.linkedPanel?s.panelId:void 0,onKeyDown:y,onKeyUp:v,onClick:w},theirProps:a,slot:E,defaultTag:"button",name:"Disclosure.Button"})}),Panel:U(function(e,t){let n=b(),{id:o=`headlessui-disclosure-panel-${n}`,...a}=e,[s,i]=_("Disclosure.Panel"),{close:c}=function K(e){let t=(0,g.useContext)(T);if(null===t){let t=Error(`<${e} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,K),t}return t}("Disclosure.Panel"),u=render_I(),f=use_sync_refs_y(t,s.panelRef,e=>{j(()=>i({type:e?4:5}))});(0,g.useEffect)(()=>(i({type:3,panelId:o}),()=>{i({type:3,panelId:null})}),[o,i]);let p=(0,g.useContext)(E),h=null!==p?(p&S.Open)===S.Open:0===s.disclosureState,y=(0,g.useMemo)(()=>({open:0===s.disclosureState,close:c}),[s,c]);return g.createElement(L.Provider,{value:s.panelId},render_C({mergeRefs:u,ourProps:{ref:f,id:o},theirProps:a,slot:y,defaultTag:"div",features:B,visible:h,name:"Disclosure.Panel"}))})})},3407:function(e,t,n){"use strict";var o=n(7294);let a=o.forwardRef(function({title:e,titleId:t,...n},a){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},n),e?o.createElement("title",{id:t},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"}))});t.Z=a},1415:function(e,t,n){"use strict";var o=n(7294);let a=o.forwardRef(function({title:e,titleId:t,...n},a){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},n),e?o.createElement("title",{id:t},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))});t.Z=a}}]);